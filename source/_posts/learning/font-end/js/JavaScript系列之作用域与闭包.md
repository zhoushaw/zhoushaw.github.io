---
title: JavaScript系列之作用域与闭包
date: 2019-4-21 9:39:35
categories: js
tags: js
---

## 作用域

在进入作用域的讨论之前先明什么是作用域，通过一句话简单描述就是：**一组明确定义的规则，它定义如何在某些位置存储变量，以及如何在稍后找到这些变量**


### 词法作用域

作用域的工作方式有两种占统治地位的模型。其中的第一种是最最常见，在绝大多数的编程语言中被使用的。它称为 **词法作用域**，我们将深入检视它。另一种仍然被一些语言（比如 Bash 脚本，Perl 中的一些模式，等等）使用的模型，称为 **动态作用域**。

JavaScript采用的是**词法作用域**，这意味着**作用域**是编写时确定的，而不是运行时确定的，当然也可以通过**欺骗**来达到动态作用域，例如使用：`eval`、`with`等关键词

> 词法分析

JavaScript的代码运行，并不是像你想象的**逐行编译**，而是在进行编译前会进行**词法分析**。也就形成了我们所说的**词法作用域**。

可以通过下面的🌰来看：

```
var value = 1;

function foo() {
    console.log(value);
}

function bar() {
    var value = 2;
    foo();
}

bar();

// 结果是 ???
```

大多数人看到这个🌰第一个反应结果是：输出`2`，但是需要注意的是foo的作用域并不存在与`bar函数`中,因为JavaScript的`作用域`是词法作用域，所以并不能获取到bar函数中 `var value = 2`的声明。

下面我们来简单描述一下这段代码的执行过程：

* 在全局环境下声明了`value变量`、`foo函数`、`bar函数`
* 执行`bar函数`，
* 在函数`bar`内部声明了`value变量`并赋值为2
* 执行，`foo函数`
* 在函数内寻找`value变量`声明，未找到,向上一层作用域继续寻找
* 在顶层作用域`window`下寻找到了`value`变量，若直到顶层作用域任未找到则报错
* 输出结果`1`

### 动态作用域

上面已经描述了词法作用域的工作方式，这里我们来稍微讲讲与**词法作用域**完全对立的**动态作用域**

我们这里就以bash为例：

```
value=1
function foo () {
    echo $value;
}
function bar () {
    local value=2;
    foo;
}
bar // 2
```

我们将上面代码保存为`scope.bash`的文件，通过执行`bash scope.bash`,最终输出`1`

### 变量提升

在代码执行前会进行代码设计




